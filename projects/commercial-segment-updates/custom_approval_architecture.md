# Custom Approval Architecture

A simplified approval system using a custom object, Screen Flows, Record-Triggered Flows, and Tray/Slack.

---

## Data Model

### Opportunity_Approval__c

| Field | Type | Purpose |
|-------|------|---------|
| `Opportunity__c` | Master-Detail | Parent Opportunity |
| `Process_Type__c` | Picklist | `Small Deal` / `Standard PS Model` |
| `Approver_Role__c` | Picklist | `Sales Leadership` / `Finance` / `PS Leadership` |
| `Level__c` | Number | 1 or 2 (for sequential approvals) |
| `Status__c` | Picklist | `Pending` / `Approved` / `Rejected` |
| `Approver__c` | Text | Who approved (from Slack) |
| `Notes__c` | Long Text | Comments from Slack modal |
| `Decision_Date__c` | DateTime | When they responded |
| `Request_Reason__c` | Picklist | `H2H` / `Connection` (Process 2 only) |
| `Slack_Message_Id__c` | Text | For tracking/updating Slack messages |

---

## The Two Processes

### Process 1: Small Deal (< 10 Physicians)

**Approval sequence:**
1. **Level 1:** JVH OR Aamir (either can approve)
2. **Level 2:** Reba (required, after Level 1)

**Records created:**
- Level 1: `Approver_Role = 'Sales Leadership'`, `Level = 1`
- Level 2: `Approver_Role = 'Finance'`, `Level = 2` (created AFTER Level 1 approved)

---

### Process 2: Standard PS Model (Commercial)

**Approval sequence:**
1. **Level 1:** Meghan OR Madeleine (either can approve)

**Records created:**
- Level 1: `Approver_Role = 'PS Leadership'`, `Level = 1`

---

## Complete Flow: Process 1 (Small Deal)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: User Submits Request                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   User clicks "Request Approval" button on Opportunity                      â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚         SCREEN FLOW                     â”‚                               â”‚
â”‚   â”‚  â€¢ Shows confirmation/context           â”‚                               â”‚
â”‚   â”‚  â€¢ Creates Opportunity_Approval__c:     â”‚                               â”‚
â”‚   â”‚    - Process_Type = 'Small Deal'        â”‚                               â”‚
â”‚   â”‚    - Approver_Role = 'Sales Leadership' â”‚                               â”‚
â”‚   â”‚    - Level = 1                          â”‚                               â”‚
â”‚   â”‚    - Status = 'Pending'                 â”‚                               â”‚
â”‚   â”‚  â€¢ Calls Tray webhook                   â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Slack Notification (Level 1)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚              TRAY.IO                    â”‚                               â”‚
â”‚   â”‚  â€¢ Receives webhook                     â”‚                               â”‚
â”‚   â”‚  â€¢ Queries SFDC for Opp + Account data  â”‚                               â”‚
â”‚   â”‚  â€¢ Sends Slack message to channel:      â”‚                               â”‚
â”‚   â”‚    - @JVH and @Aamir mentioned          â”‚                               â”‚
â”‚   â”‚    - Shows deal context                 â”‚                               â”‚
â”‚   â”‚    - Approve / Reject buttons           â”‚                               â”‚
â”‚   â”‚    - Approval Record ID in payload      â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚              SLACK                      â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  ðŸ“‹ Small Deal Approval Request         â”‚                               â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                               â”‚
â”‚   â”‚  Account: Acme Health                   â”‚                               â”‚
â”‚   â”‚  Opportunity: Q1 Renewal                â”‚                               â”‚
â”‚   â”‚  Physician Count: 8                     â”‚                               â”‚
â”‚   â”‚  Amount: $50,000                        â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  [âœ“ Approve]  [âœ— Reject]                â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Level 1 Approval                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   JVH clicks "Approve" â†’ Slack modal for notes                              â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚              TRAY.IO                    â”‚                               â”‚
â”‚   â”‚  â€¢ Receives button click                â”‚                               â”‚
â”‚   â”‚  â€¢ Updates Opportunity_Approval__c:     â”‚                               â”‚
â”‚   â”‚    - Status = 'Approved'                â”‚                               â”‚
â”‚   â”‚    - Approver = 'JVH'                   â”‚                               â”‚
â”‚   â”‚    - Notes = (from modal)               â”‚                               â”‚
â”‚   â”‚    - Decision_Date = NOW()              â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚    RECORD-TRIGGERED FLOW                â”‚                               â”‚
â”‚   â”‚    (on Opportunity_Approval__c)         â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  Trigger: Status changed to 'Approved'  â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  Logic:                                 â”‚                               â”‚
â”‚   â”‚  IF Process_Type = 'Small Deal'         â”‚                               â”‚
â”‚   â”‚     AND Level = 1                       â”‚                               â”‚
â”‚   â”‚  THEN:                                  â”‚                               â”‚
â”‚   â”‚    â€¢ Create NEW Opportunity_Approval__c â”‚                               â”‚
â”‚   â”‚      - Process_Type = 'Small Deal'      â”‚                               â”‚
â”‚   â”‚      - Approver_Role = 'Finance'        â”‚                               â”‚
â”‚   â”‚      - Level = 2                        â”‚                               â”‚
â”‚   â”‚      - Status = 'Pending'               â”‚                               â”‚
â”‚   â”‚    â€¢ Call Tray webhook (for Reba)       â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Slack Notification (Level 2)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚              TRAY.IO                    â”‚                               â”‚
â”‚   â”‚  â€¢ Receives webhook                     â”‚                               â”‚
â”‚   â”‚  â€¢ Queries SFDC for context             â”‚                               â”‚
â”‚   â”‚  â€¢ Sends Slack message:                 â”‚                               â”‚
â”‚   â”‚    - @Reba mentioned                    â”‚                               â”‚
â”‚   â”‚    - Shows "Level 1 approved by JVH"    â”‚                               â”‚
â”‚   â”‚    - Approve / Reject buttons           â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚              SLACK                      â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  ðŸ“‹ Small Deal Approval - Final Review  â”‚                               â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                               â”‚
â”‚   â”‚  Account: Acme Health                   â”‚                               â”‚
â”‚   â”‚  Opportunity: Q1 Renewal                â”‚                               â”‚
â”‚   â”‚  Physician Count: 8                     â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  âœ“ Level 1: Approved by JVH             â”‚                               â”‚
â”‚   â”‚    "Looks good, standard deal"          â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  [âœ“ Approve]  [âœ— Reject]                â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Level 2 Approval â†’ Complete                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Reba clicks "Approve" â†’ Slack modal for notes                             â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚              TRAY.IO                    â”‚                               â”‚
â”‚   â”‚  â€¢ Updates Opportunity_Approval__c:     â”‚                               â”‚
â”‚   â”‚    - Status = 'Approved'                â”‚                               â”‚
â”‚   â”‚    - Approver = 'Reba'                  â”‚                               â”‚
â”‚   â”‚    - Notes = (from modal)               â”‚                               â”‚
â”‚   â”‚    - Decision_Date = NOW()              â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚    RECORD-TRIGGERED FLOW                â”‚                               â”‚
â”‚   â”‚    (on Opportunity_Approval__c)         â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  Trigger: Status changed to 'Approved'  â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  Logic:                                 â”‚                               â”‚
â”‚   â”‚  IF Process_Type = 'Small Deal'         â”‚                               â”‚
â”‚   â”‚     AND Level = 2                       â”‚                               â”‚
â”‚   â”‚  THEN:                                  â”‚                               â”‚
â”‚   â”‚    â€¢ Update Opportunity:                â”‚                               â”‚
â”‚   â”‚      - Approval_Status__c = 'Approved'  â”‚                               â”‚
â”‚   â”‚    â€¢ (Optional) Post to Slack channel   â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚         OPPORTUNITY                     â”‚                               â”‚
â”‚   â”‚  Approval_Status__c = 'Approved'        â”‚                               â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                               â”‚
â”‚   â”‚  Validation rule NOW PASSES             â”‚                               â”‚
â”‚   â”‚  â†’ Opp can be closed                    â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete Flow: Process 2 (Standard PS Model)

Simpler â€” single level approval.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: User Submits Request                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚         SCREEN FLOW                     â”‚                               â”‚
â”‚   â”‚  â€¢ Captures reason (H2H / Connection)   â”‚                               â”‚
â”‚   â”‚  â€¢ Creates Opportunity_Approval__c:     â”‚                               â”‚
â”‚   â”‚    - Process_Type = 'Standard PS Model' â”‚                               â”‚
â”‚   â”‚    - Approver_Role = 'PS Leadership'    â”‚                               â”‚
â”‚   â”‚    - Level = 1                          â”‚                               â”‚
â”‚   â”‚    - Status = 'Pending'                 â”‚                               â”‚
â”‚   â”‚    - Request_Reason = (user input)      â”‚                               â”‚
â”‚   â”‚  â€¢ Calls Tray webhook                   â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Slack Notification                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚              SLACK                      â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  ðŸ“‹ Standard PS Model Request           â”‚                               â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                               â”‚
â”‚   â”‚  Account: Acme Health                   â”‚                               â”‚
â”‚   â”‚  Opportunity: Q1 Renewal                â”‚                               â”‚
â”‚   â”‚  Reason: H2H                            â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  [âœ“ Approve]  [âœ— Reject]                â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Approval â†’ Complete                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Meghan clicks "Approve"                                                   â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   Tray updates Opportunity_Approval__c                                      â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚    RECORD-TRIGGERED FLOW                â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚  IF Process_Type = 'Standard PS Model'  â”‚                               â”‚
â”‚   â”‚     AND Level = 1                       â”‚                               â”‚
â”‚   â”‚     AND Status = 'Approved'             â”‚                               â”‚
â”‚   â”‚  THEN:                                  â”‚                               â”‚
â”‚   â”‚    â€¢ Update Opportunity:                â”‚                               â”‚
â”‚   â”‚      - Approval_Status__c = 'Approved'  â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                         â”‚                                                   â”‚
â”‚                         â–¼                                                   â”‚
â”‚   Opp can be closed                                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Rejection Flow

When someone clicks "Reject":

1. **Tray** updates `Opportunity_Approval__c`:
   - `Status = 'Rejected'`
   - `Approver`, `Notes`, `Decision_Date`

2. **Record-Triggered Flow** detects rejection:
   - Updates `Opportunity.Approval_Status__c = 'Rejected'`
   - (Optional) Notifies the rep via Slack/email

3. **Rep** can re-submit if needed (starts new approval records)

---

## Component Summary

| Component | What It Does |
|-----------|--------------|
| **Dynamic Action Button** | Shows "Request Approval" when criteria met (< 10 physicians OR PS Model = Standard) |
| **Screen Flow** | Captures input, creates approval record, calls Tray |
| **Opportunity_Approval__c** | Stores each approval decision with full history |
| **Tray.io** | Sends Slack messages, receives button clicks, updates SFDC |
| **Record-Triggered Flow** | Handles sequencing (creates Level 2 after Level 1), updates Opp status |
| **Validation Rule** | Blocks Opp close until `Approval_Status__c = 'Approved'` |

---

## Salesforce Components to Build

### 1. Custom Object: Opportunity_Approval__c
See data model above.

### 2. Fields on Opportunity
- `Approval_Status__c` (Picklist: Pending/Approved/Rejected)

### 3. Screen Flow: "Request Approval"
- Input: Opportunity ID
- Screen: Reason picklist (for Process 2)
- Create Record: Opportunity_Approval__c
- Action: Call Tray webhook (HTTP Callout or Platform Event)

### 4. Record-Triggered Flow: "Handle Approval Decision"
Trigger: `Opportunity_Approval__c` when `Status__c` is changed

Logic branches:
- **Small Deal, Level 1, Approved** â†’ Create Level 2 record, call Tray
- **Small Deal, Level 2, Approved** â†’ Update Opp status to Approved
- **Small Deal, Any Level, Rejected** â†’ Update Opp status to Rejected
- **Standard PS Model, Level 1, Approved** â†’ Update Opp status to Approved
- **Standard PS Model, Level 1, Rejected** â†’ Update Opp status to Rejected

### 5. Validation Rule on Opportunity
```
AND(
  IsClosed,
  ISPICKVAL(StageName, "Closed Won"),
  OR(
    Total_Physician_Count__c < 10,
    ISPICKVAL(PS_Model__c, "Standard")
  ),
  NOT(ISPICKVAL(Approval_Status__c, "Approved"))
)
```
Error: "This opportunity requires approval before closing."

### 6. Dynamic Action
- Button: "Request Approval"
- Visibility: `Physician_Count < 10 OR PS_Model = 'Standard'`
- Action: Launch Screen Flow

---

## Tray.io Workflows

### Workflow 1: Send Approval Request to Slack
- **Trigger:** Webhook from Salesforce
- **Steps:**
  1. Query SFDC for Opp + Account details
  2. Determine approvers based on `Process_Type` and `Level`
  3. Build Slack Block Kit message
  4. Post to Slack channel with Approve/Reject buttons
  5. (Optional) Store Slack message ID back to approval record

### Workflow 2: Handle Slack Button Click
- **Trigger:** Slack interaction
- **Steps:**
  1. Show modal for notes
  2. Parse approval record ID from button payload
  3. Update `Opportunity_Approval__c` in SFDC:
     - Status
     - Approver (from Slack user)
     - Notes
     - Decision_Date
  4. (Optional) Update original Slack message to show decision

---

---

## All Flows Needed

### Flow 1: Screen Flow â€” "Request Approval"

**Type:** Screen Flow
**Trigger:** Dynamic Action button on Opportunity
**Purpose:** User-initiated approval submission

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCREEN FLOW: Request Approval                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  INPUT VARIABLES:                                               â”‚
â”‚  â€¢ recordId (Opportunity ID)                                    â”‚
â”‚                                                                 â”‚
â”‚  STEP 1: Get Record                                             â”‚
â”‚  â€¢ Query Opportunity for Physician_Count, PS_Model, etc.        â”‚
â”‚                                                                 â”‚
â”‚  STEP 2: Decision â€” Which Process?                              â”‚
â”‚  â€¢ IF Physician_Count < 10 â†’ Process 1 (Small Deal)             â”‚
â”‚  â€¢ ELSE IF PS_Model = 'Standard' â†’ Process 2 (Standard PS)      â”‚
â”‚                                                                 â”‚
â”‚  STEP 3: Screen (Process 2 only)                                â”‚
â”‚  â€¢ Picklist: "Reason for Standard PS Model request"             â”‚
â”‚    - H2H                                                        â”‚
â”‚    - Connection                                                 â”‚
â”‚                                                                 â”‚
â”‚  STEP 4: Create Record â€” Opportunity_Approval__c                â”‚
â”‚  â€¢ Opportunity__c = {!recordId}                                 â”‚
â”‚  â€¢ Process_Type__c = (based on decision)                        â”‚
â”‚  â€¢ Approver_Role__c = 'Sales Leadership' or 'PS Leadership'     â”‚
â”‚  â€¢ Level__c = 1                                                 â”‚
â”‚  â€¢ Status__c = 'Pending'                                        â”‚
â”‚  â€¢ Request_Reason__c = (if Process 2)                           â”‚
â”‚                                                                 â”‚
â”‚  STEP 5: Action â€” Call Tray Webhook                             â”‚
â”‚  â€¢ HTTP Callout (or Invoke Apex, or Platform Event)             â”‚
â”‚  â€¢ Payload:                                                     â”‚
â”‚    - approval_record_id: {!newApprovalRecord.Id}                â”‚
â”‚    - opportunity_id: {!recordId}                                â”‚
â”‚    - process_type: {!processType}                               â”‚
â”‚                                                                 â”‚
â”‚  STEP 6: Screen â€” Confirmation                                  â”‚
â”‚  â€¢ "Your approval request has been submitted."                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Flow 2: Record-Triggered Flow â€” "Handle Approval Decision"

**Type:** Record-Triggered Flow
**Object:** Opportunity_Approval__c
**Trigger:** When `Status__c` is created or updated
**Entry Conditions:** `Status__c` equals `Approved` OR `Rejected`
**Purpose:** Route to next level or update Opportunity

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RECORD-TRIGGERED FLOW: Handle Approval Decision                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  TRIGGER:                                                       â”‚
â”‚  â€¢ Object: Opportunity_Approval__c                              â”‚
â”‚  â€¢ When: Record is Updated                                      â”‚
â”‚  â€¢ Condition: Status__c CHANGED to 'Approved' or 'Rejected'     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  DECISION: What happened?                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚     â–¼           â–¼             â–¼             â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚REJECTâ”‚  â”‚SMALL DEALâ”‚  â”‚SMALL DEALâ”‚  â”‚STANDARD  â”‚             â”‚
â”‚  â”‚(any) â”‚  â”‚LEVEL 1   â”‚  â”‚LEVEL 2   â”‚  â”‚PS MODEL  â”‚             â”‚
â”‚  â”‚      â”‚  â”‚APPROVED  â”‚  â”‚APPROVED  â”‚  â”‚APPROVED  â”‚             â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
â”‚     â”‚           â”‚             â”‚             â”‚                   â”‚
â”‚     â–¼           â–¼             â–¼             â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚Update Opp:       â”‚  â”‚Create       â”‚  â”‚Update Opp:  â”‚         â”‚
â”‚  â”‚Status='Rejected' â”‚  â”‚Level 2      â”‚  â”‚Status=      â”‚         â”‚
â”‚  â”‚                  â”‚  â”‚Approval     â”‚  â”‚'Approved'   â”‚         â”‚
â”‚  â”‚(Optional: notify â”‚  â”‚Record       â”‚  â”‚             â”‚         â”‚
â”‚  â”‚rep via Slack)    â”‚  â”‚             â”‚  â”‚             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                               â”‚                                 â”‚
â”‚                               â–¼                                 â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                        â”‚Call Tray    â”‚                          â”‚
â”‚                        â”‚Webhook      â”‚                          â”‚
â”‚                        â”‚(for Reba)   â”‚                          â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Decision Logic Detail:**

| Condition | Action |
|-----------|--------|
| `Status = 'Rejected'` (any) | Update Opp `Approval_Status__c = 'Rejected'` |
| `Process_Type = 'Small Deal'` AND `Level = 1` AND `Status = 'Approved'` | Create Level 2 record, call Tray |
| `Process_Type = 'Small Deal'` AND `Level = 2` AND `Status = 'Approved'` | Update Opp `Approval_Status__c = 'Approved'` |
| `Process_Type = 'Standard PS Model'` AND `Level = 1` AND `Status = 'Approved'` | Update Opp `Approval_Status__c = 'Approved'` |

---

### Flow 3 (Optional): Autolaunched Flow â€” "Call Tray Webhook"

**Type:** Autolaunched Flow (Subflow)
**Purpose:** Reusable callout to Tray

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUTOLAUNCHED FLOW: Call Tray Webhook                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  INPUT VARIABLES:                                               â”‚
â”‚  â€¢ approvalRecordId (Text)                                      â”‚
â”‚  â€¢ opportunityId (Text)                                         â”‚
â”‚  â€¢ processType (Text)                                           â”‚
â”‚  â€¢ level (Number)                                               â”‚
â”‚                                                                 â”‚
â”‚  STEP 1: Action â€” HTTP Callout (External Service)               â”‚
â”‚  â€¢ Method: POST                                                 â”‚
â”‚  â€¢ URL: https://tray.io/webhook/your-webhook-id                 â”‚
â”‚  â€¢ Body:                                                        â”‚
â”‚    {                                                            â”‚
â”‚      "approval_record_id": "{!approvalRecordId}",               â”‚
â”‚      "opportunity_id": "{!opportunityId}",                      â”‚
â”‚      "process_type": "{!processType}",                          â”‚
â”‚      "level": {!level}                                          â”‚
â”‚    }                                                            â”‚
â”‚                                                                 â”‚
â”‚  NOTE: Can also use Platform Events or Invocable Apex           â”‚
â”‚  instead of direct HTTP callout.                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Flow Summary Table

| # | Flow Name | Type | Trigger | Purpose |
|---|-----------|------|---------|---------|
| 1 | Request Approval | Screen Flow | Dynamic Action button | User submits request, creates approval record, calls Tray |
| 2 | Handle Approval Decision | Record-Triggered | `Opportunity_Approval__c` Status changed | Routes to next level or completes approval |
| 3 | Call Tray Webhook | Autolaunched (Subflow) | Called by other flows | Reusable HTTP callout to Tray |

---

## What You End Up With

**On the Opportunity:**
- Related list showing all approval records
- Clear history: who approved, when, with what notes
- Status field that validation rule checks

**In Slack:**
- Custom formatted messages with deal context
- Approve/Reject buttons
- Modal for notes
- Updated messages showing decisions

**Auditability:**
- Every approval is a record
- Full field history tracking on the custom object
- Clear trail of who did what and when
